<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stellar Observer | Atlas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
<div class="split-container">
  <!-- LEFT: MAP -->
  <div id="mapSection">
    
    <!-- CONTROLS OVERLAY -->
    <div class="absolute top-4 left-4 z-20 flex flex-col gap-2">
      <!-- Back Button -->
      <button id="backBtn" onclick="exitConstellationMode()" class="hidden bg-pink-500/90 hover:bg-pink-400 text-white px-4 py-2 rounded-lg font-bold text-xs uppercase shadow-lg shadow-pink-500/20 backdrop-blur transition-all flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
        Return to Atlas
      </button>

      <!-- Standard Controls -->
      <div id="mapControls" class="bg-black/60 backdrop-blur-md p-3 rounded-lg border border-white/10 shadow-xl w-40">
        <h2 class="text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-2">Layers</h2>
        <div class="flex items-center gap-2 mb-1">
          <input type="checkbox" id="boundaryToggle" checked class="w-3 h-3 rounded bg-slate-800 border-slate-700 text-sky-500 cursor-pointer">
          <label for="boundaryToggle" class="text-[10px] uppercase font-bold text-slate-300 cursor-pointer">Boundaries</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="gridToggle" checked class="w-3 h-3 rounded bg-slate-800 border-slate-700 text-sky-500 cursor-pointer" onchange="toggleGrid()">
          <label for="gridToggle" class="text-[10px] uppercase font-bold text-slate-300 cursor-pointer">Grid</label>
        </div>
      </div>
    </div>

    <!-- CONSTELLATION TITLE OVERLAY -->
    <div id="focusTitle" class="absolute top-4 right-4 z-10 text-right hidden pointer-events-none">
       <h1 id="ft-name" class="text-4xl font-black text-white tracking-tighter drop-shadow-lg">ORION</h1>
       <h2 id="ft-abbr" class="text-xl text-pink-400 font-mono drop-shadow-md">Ori</h2>
    </div>

    <button onclick="toggleConsole()" class="absolute bottom-4 left-4 z-50 bg-slate-900/80 backdrop-blur text-[10px] text-white px-3 py-1.5 rounded border border-white/20 uppercase font-bold hover:bg-slate-800 transition-colors">
      Debug Log
    </button>

    <!-- SVG CANVAS -->
    <svg id="skyCanvas" viewBox="0 0 1000 1000" class="w-full h-full cursor-crosshair">
      <defs><clipPath id="horizonClip"><circle cx="500" cy="500" r="450"/></clipPath></defs>
      <g id="gridLayer"></g>
      <g id="boundaryLayer" clip-path="url(#horizonClip)"></g>
      <g id="linesLayer" clip-path="url(#horizonClip)"></g> 
      <g id="starLayer" clip-path="url(#horizonClip)"></g>
    </svg>
  </div>

  <!-- RIGHT: DASHBOARD -->
  <div id="dashboardSection" class="p-6">
    <div class="flex justify-between items-end mb-6">
      <div>
        <h1 class="text-2xl font-black tracking-tighter text-white">STELLAR<span class="text-sky-500 font-light">OBSERVER</span></h1>
        <div id="status" class="flex items-center text-[10px] font-bold text-slate-500 uppercase tracking-tighter">
          <span class="status-dot status-loading"></span>
          <span>Initializing...</span>
        </div>
      </div>
      <button onclick="calculateView()" class="bg-sky-500 hover:bg-sky-400 text-slate-950 text-[11px] font-black px-4 py-2 rounded-lg transition-all uppercase">Refresh</button>
    </div>

    <div id="manualLoad">
      <h3 class="text-red-400 font-bold text-xs uppercase mb-2">⚠ Browser blocked automatic load</h3>
      <p class="text-[10px] text-slate-300 mb-3">Please select <strong>stars.json</strong>, <strong>boundaries.json</strong>, and <strong>lines.json</strong>:</p>
      <input type="file" id="filePicker" multiple accept=".json"
        class="text-xs text-white file:bg-slate-800 file:text-white file:border-0 file:px-3 file:py-1 file:rounded file:mr-2 file:cursor-pointer"
        onchange="handleManualFiles(this)">
    </div>

    <!-- PANELS -->
    <div class="grid grid-cols-2 gap-4 mb-6">
      <div id="starFocus" class="glass focus-panel p-4 rounded-2xl border-white/5 relative overflow-hidden h-32 flex flex-col justify-center">
        <label class="absolute top-3 left-4 text-[9px] font-bold text-sky-500/50 uppercase tracking-widest">Selected Star</label>
        <div id="sf-name" class="text-xl font-bold text-white truncate mt-2">—</div>
        <div id="sf-sec" class="text-xs text-slate-400 truncate mb-2 min-h-[1em]"></div>
        <div class="flex gap-4">
          <div><span class="text-[9px] text-slate-500 uppercase block">Mag</span> <span id="sf-mag" class="mono text-sky-400 text-sm">—</span></div>
          <div><span class="text-[9px] text-slate-500 uppercase block">Alt/Az</span> <span id="sf-pos" class="mono text-sky-400 text-sm">—</span></div>
        </div>
      </div>
      <div id="constFocus" class="glass focus-panel p-4 rounded-2xl border-white/5 relative overflow-hidden h-32 flex flex-col justify-center">
        <label class="absolute top-3 left-4 text-[9px] font-bold text-pink-500/50 uppercase tracking-widest">Constellation</label>
        <div id="cf-name" class="text-xl font-bold text-white truncate">—</div>
        <div id="cf-abbr" class="mono text-pink-400 text-sm">—</div>
      </div>
    </div>

    <!-- CONTROLS -->
    <div class="grid grid-cols-2 gap-3 mb-6">
      <div class="glass px-3 py-2 rounded-xl">
        <label class="block text-[8px] font-bold text-slate-500 uppercase mb-1">Time</label>
        <div class="flex items-center gap-1">
          <input type="datetime-local" id="timeInput" class="flex-1 bg-transparent text-white border-none focus:ring-0 text-xs mono p-0 min-w-0" onchange="calculateView()">
          <button onclick="adjustTime(-1)" class="bg-slate-700/50 hover:bg-slate-600 text-white w-7 h-7 rounded flex items-center justify-center text-base font-bold transition-colors flex-shrink-0" title="−1 hour">−</button>
          <button onclick="adjustTime(1)" class="bg-slate-700/50 hover:bg-slate-600 text-white w-7 h-7 rounded flex items-center justify-center text-base font-bold transition-colors flex-shrink-0" title="+1 hour">+</button>
        </div>
      </div>
      <div class="glass px-3 py-2 rounded-xl">
        <label class="block text-[8px] font-bold text-slate-500 uppercase mb-1">Max Magnitude</label>
        <div class="flex items-center gap-2">
          <span id="magVal" class="mono text-sky-400 text-sm font-bold min-w-[2.5rem]">5.0</span>
          <button onclick="adjustMagnitude(-1)" class="bg-slate-700/50 hover:bg-slate-600 text-white w-7 h-7 rounded flex items-center justify-center text-base font-bold transition-colors flex-shrink-0">−</button>
          <button onclick="adjustMagnitude(1)" class="bg-slate-700/50 hover:bg-slate-600 text-white w-7 h-7 rounded flex items-center justify-center text-base font-bold transition-colors flex-shrink-0">+</button>
        </div>
      </div>
    </div>

    <!-- TABLE -->
    <div class="glass rounded-2xl flex-1 flex flex-col overflow-hidden">
      <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex justify-between items-center">
        <h3 class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Visible Objects</h3>
        <input type="text" id="searchInput" placeholder="Search stars..." onkeyup="filterTable()">
        <span id="starCount" class="text-sky-500 mono text-[10px]">0</span>
      </div>
      <div class="star-table-container">
        <table class="w-full text-left border-collapse">
          <thead class="sticky top-0 bg-[#0f172a] shadow-sm z-10">
            <tr class="text-[9px] uppercase text-slate-500 font-bold">
              <th class="px-4 py-2">Name</th>
              <th class="px-4 py-2">Mag</th>
              <th class="px-4 py-2">Alt/Az</th>
              <th class="px-4 py-2">Constellation</th>
            </tr>
          </thead>
          <tbody id="starList" class="divide-y divide-white/5 text-[11px] mono"></tbody>
        </table>
      </div>
    </div>

    <div id="debugConsole">
      <div class="text-white border-b border-white/20 mb-2 pb-1 sticky top-0 bg-black font-bold flex justify-between">
        <span>SYSTEM LOG</span>
        <span class="text-[9px] text-slate-400 cursor-pointer" onclick="document.getElementById('debugConsole').innerHTML = ''">CLEAR</span>
      </div>
    </div>
  </div>
</div>

<script type="module" src="js/app.js"></script>
</body>
</html>